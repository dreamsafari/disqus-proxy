(this["webpackJsonpdisqus-proxy-client"]=this["webpackJsonpdisqus-proxy-client"]||[]).push([[0],{38:function(e,t,a){e.exports=a(60)},60:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),o=a(12),l=a.n(o),c=a(13),s=a(15),m=a(14),i=a(16),u=a(5),p=a(62),d=a(63),h=a(17),g=a(32),f=a(33),y=a.n(f),b=a(64),E=a(65),O=a(66),v=a(67),j=a(68),C=a(69),N=a(70);function k(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}var w=function(e){function t(e,a){var n;return Object(c.a)(this,t),(n=Object(s.a)(this,Object(m.a)(t).call(this,e,a))).replyToComment=function(e){var t=n.state.arrangedComments;(0,n.props.replyOnClick)(t[e.target.getAttribute("index")])},n.pageOnClick=function(e){n.setState({currentPage:e})},n.state={arrangedComments:[],currentPage:1},n.replyToComment=n.replyToComment.bind(Object(u.a)(n)),n.pageOnClick=n.pageOnClick.bind(Object(u.a)(n)),n}return Object(i.a)(t,e),Object(g.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.comments;if(e&&e.response.length>0)for(var t=0;t<e.response.length;t+=1)null==e.response[t].parent&&this.createCommentElem(e.response[t],t,-1,0)}},{key:"createCommentElem",value:function(e,t,a,n){var r=this.state.arrangedComments,o=this.props.comments;if(void 0!==o){r.push(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?k(a,!0).forEach((function(t){Object(h.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):k(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e,{level:n,parentCommentObj:o.response[a]})),this.setState({arrangedComments:r});for(var l=0;l<o.response.length;l+=1)+o.response[l].parent===+o.response[t].id&&this.createCommentElem(o.response[l],l,t,n+1)}}},{key:"render",value:function(){var e=this,t=this.state,a=t.currentPage,n=t.arrangedComments,o=[];if(n&&n.length>0){for(var l=20*(a-1);l<20*a&&l<n.length;l+=1){var c=n[l],s=c.parentCommentObj;o.push(r.a.createElement(p.a,{key:c.id},r.a.createElement(d.a,null,r.a.createElement(b.a,{className:"mt-2",size:"sm",style:{marginLeft:"".concat(c.level,"rem")}},r.a.createElement(E.a,{className:"p-1"},r.a.createElement(O.a,{color:"primary",href:c.author.url},c.author.name),null!=s&&[r.a.createElement("i",{className:"fa fa-angle-right p-1","aria-hidden":"true",key:c.id}),r.a.createElement(O.a,{color:"primary",href:s.author.url},s.author.name)],r.a.createElement("span",{className:"font-weight-bold"}),r.a.createElement("span",{className:"pl-1"},"-"," ",r.a.createElement(O.a,{color:"secondary"},y()(c.createdAt).format("YYYY-MM-DD"))),r.a.createElement("span",null,r.a.createElement(v.a,{size:"sm",color:"link",className:"float-right",style:{lineHeight:1},index:l,onClick:this.replyToComment},"\u56de\u590d"))),r.a.createElement(j.a,{className:"p-1"},r.a.createElement(p.a,{className:"m-0"},r.a.createElement("div",{className:"d-lg-block d-md-block d-none img-fluid"},r.a.createElement("img",{className:"img-fluid",width:"50px",height:"50px",src:c.author.avatar.permalink,alt:""})),r.a.createElement("div",{className:"col"},r.a.createElement("div",{dangerouslySetInnerHTML:{__html:c.message}}))))))))}var m=[];if(n.length>20){var i=!(1!==a),u=!(a!==Math.floor(n.length/20)+1);m.push(r.a.createElement(v.a,{size:"sm",color:"toolbar",key:"0",disabled:i,onClick:function(){return e.pageOnClick(a-1)}},"<"));for(var h=function(t){m.push(r.a.createElement(v.a,{size:"sm",key:t,color:a===t?"primary":"toolbar",onClick:function(){return e.pageOnClick(t)}},t))},g=1;g<=n.length/20+1;g+=1)h(g);m.push(r.a.createElement(v.a,{size:"sm",color:"toolbar",key:"-1",disabled:u,onClick:function(){return e.pageOnClick(a+1)}},">"))}o.push(r.a.createElement(p.a,{className:"pt-3"},r.a.createElement(d.a,null,n.length<=20&&r.a.createElement("span",{className:"pl-1"},"\u603b\u8ba1"," ",n.length," ","\u6761\u8bc4\u8bba,"),n.length>20&&r.a.createElement("span",{className:"pl-1"},"\u603b\u8ba1"," ",n.length," ","\u6761\u8bc4\u8bba, \u663e\u793a"," ",20*(a-1)+1," ","-"," ",Math.min(20*a,n.length)," ","\u6761\u8bc4\u8bba"),r.a.createElement("span",{className:"float-right"},r.a.createElement(C.a,null,r.a.createElement(N.a,null,m))))))}else o.push(r.a.createElement(p.a,null,r.a.createElement(d.a,null,"\u8fd9\u7bc7\u6587\u7ae0\u6682\u65f6\u6ca1\u6709\u4eba\u8bc4\u8bba, \u6b22\u8fce\u8bc4\u8bba\u3002")));return o}}]),t}(r.a.Component),P=a(22),S=a.n(P),x=a(34),T=a(37),q=a(71),D=a(72),M=a(35),z=a(73),L=a(77),R=a(74),F=a(78),_=a(75),A=a(76),I=window;a(48);function Y(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}var B=I.disqusProxy,G=B.server,H=B.port,J=B.protocol,Z=function(e){function t(e,a){var n;return Object(c.a)(this,t),(n=Object(s.a)(this,Object(m.a)(t).call(this,e,a))).toggleNewFeature=function(e){var t=n.state.showNewFeature;n.setState({showNewFeature:!t})},n.componentDidMount=function(){2019===(new Date).getFullYear()&&n.setState({showNewFeature:!0})},n.inputOnChange=function(e){var t=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Y(a,!0).forEach((function(t){Object(h.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Y(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},n.state),a=e.currentTarget;t[a.name]=a.value,n.setState(t)},n.toggleEmojiPicker=function(){var e=n.state.showEmojiPicker;n.setState({showEmojiPicker:!e})},n.toggleModal=function(e){var t=e.target.getAttribute("pageName");n.setState({modalType:null===t?"":t})},n.hideModal=function(){n.setState({modalType:""})},n.postComment=function(){var e=Object(x.a)(S.a.mark((function e(t){var a,r,o,l,c,s,m,i,u,p,d;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.persist(),t.target.disabled=!0,a=n.state,r=a.email,o=a.name,l=a.url,c=a.message,s=n.props,m=s.thread,i=s.replyToCommentObj,u=/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/,p="",0===c.trim().length?p="Message is blank":0===o.length?p="Invalid Name":u.test(r)||(p="Invalid Email"),!(p.length>0)){e.next=11;break}return n.setState({error:p}),t.target.disabled=!1,e.abrupt("return");case 11:return d=["".concat(J,"://").concat(G),void 0!==H?":".concat(H):""].join(""),e.next=14,fetch("".concat(d,"/api/createComment"),{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({author_email:r,author_name:o,author_url:l,message:c,thread:m,parent:void 0!==i?i.id:null})}).then((function(e){return e.json()})).then((function(e){0===e.code?n.setState({comments:"",commentsLoaded:!1,name:"",email:"",message:"",error:"\u8bc4\u8bba\u6210\u529f, \u7b49\u5f85\u5ba1\u6838..."}):n.setState({error:e.response})})).catch((function(){n.setState({error:"\u554a\u54c8\u597d\u50cf\u51fa\u9519\u4e86, \u5237\u65b0\u8bd5\u8bd5..."})}));case 14:t.target.disabled=void 0;case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.render=function(){var e=n.state,t=e.name,a=e.message,o=e.email,l=e.url,c=e.error,s=e.modalType,m=e.showEmojiPicker,i=e.showNewFeature,u=n.props,h=u.cancelOnClick,g=u.replyToCommentObj,f=r.a.createElement("button",{className:"close",onClick:n.hideModal},"\xd7");return r.a.createElement(p.a,null,r.a.createElement(d.a,null,r.a.createElement(b.a,null,r.a.createElement(E.a,{className:"card-header d-flex justify-content-between p-1"},r.a.createElement("div",{style:{fontSize:"1rem"},className:"mr-auto"},"\u7559\u8a00\u677f"),r.a.createElement(v.a,{color:"url",className:"p-0 mr-1 text-primary",pageName:"about",onClick:n.toggleModal},"\u5173\u4e8e")),r.a.createElement(j.a,{className:"m-0 p-0"},r.a.createElement(q.a,{className:"p-1 pt-2",size:"small"},g&&r.a.createElement(D.a,{addonType:"prepend"},r.a.createElement(M.a,{size:"small"},"\u56de\u590d:"," ",g.author.name)),r.a.createElement(z.a,{type:"text",placeholder:"Name",className:"",value:t,name:"name",onChange:n.inputOnChange}),r.a.createElement(z.a,{type:"email",placeholder:"Email",className:"",value:o,name:"email",onChange:n.inputOnChange}),r.a.createElement(z.a,{type:"url",placeholder:"URL (Optional)",className:"",value:l,name:"url",onChange:n.inputOnChange})),r.a.createElement(p.a,{className:"m-0 p-0"},r.a.createElement(d.a,{className:"d-flex m-0 p-1 border-0"},r.a.createElement("textarea",{className:"form-control p-2 m-0",name:"message",onChange:n.inputOnChange,value:a,placeholder:"Message"})))),r.a.createElement("div",{className:"card-footer text-muted m-0 p-0 form-group d-flex flex-row-reverse position-relative"},r.a.createElement("span",{className:"small text-danger"}),g&&r.a.createElement(v.a,{className:"btn-sm m-1",onClick:h},"Cancel"),r.a.createElement(v.a,{color:"primary",size:"sm",className:"m-1",onClick:n.postComment},"Post"),r.a.createElement(v.a,{color:"light",size:"sm",className:"m-1",onClick:n.toggleEmojiPicker,id:"emoji"},r.a.createElement("i",{className:"fa fa-smile-o"})),r.a.createElement(L.a,{placement:"top",isOpen:i,autohide:!0,target:"emoji",toggle:n.toggleNewFeature},"New! Try emoji here~"),m&&r.a.createElement("span",{className:"position-absolute mt-5",style:{zIndex:1e3}},r.a.createElement(T.a,{set:"google",onSelect:function(e){n.setState({message:a+e.native})}})))),c.length>0&&r.a.createElement(R.a,{color:"danger",className:"small p-2"},c),r.a.createElement(F.a,{isOpen:"about"===s,size:"lg"},r.a.createElement(_.a,{close:f},"Disqus Proxy"),r.a.createElement(A.a,null,r.a.createElement("span",null,"Powered By: "),["React","Bootstrap","Typescript","Koa"].map((function(e){return r.a.createElement(O.a,{color:"secondary",className:"m-1"},e)})),r.a.createElement("br",null),r.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://github.com/szhielelp/disqus-proxy"},"Github"),r.a.createElement("br",null),r.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"http://szhshp.org/tech/2018/09/16/disqusrebuild2.html"},"\u4f7f\u7528\u6307\u5bfc")))))},n.state={comments:"",commentsLoaded:!1,name:"",email:"",url:"",message:"",error:"",modalType:"",showEmojiPicker:!1,showNewFeature:!1},n}return Object(i.a)(t,e),t}(r.a.Component),W=function(e){function t(e,a){var n;return Object(c.a)(this,t),(n=Object(s.a)(this,Object(m.a)(t).call(this,e,a))).componentDidMount=function(){var e=I.disqusProxy,t=e.server,a=e.port,r=e.identifier,o=e.protocol,l=e.debug,c=["".concat(o,"://").concat(t),void 0!==a?":".concat(a):""].join("");l&&console.log("Host Name: ".concat(c)),fetch("".concat(c,"/api/getComments?identifier=").concat(r),{method:"GET"}).then((function(e){return e.json()})).then((function(e){return n.setState({comments:0===e.code?e:null,commentsLoaded:!0})})),fetch("".concat(c,"/api/getThreads?identifier=").concat(r),{method:"GET"}).then((function(e){return e.json()})).then((function(e){return n.setState({thread:e.response[0].id})})).catch((function(){return n.setState({msg:"Load Failed"})}))},n.toggleReplyMode=function(e){n.setState({replyCommentObj:e})},n.cancelReply=function(){n.toggleReplyMode(void 0)},n.render=function(){var e=n.state,t=e.thread,a=e.replyCommentObj,o=e.commentsLoaded,l=e.comments,c=e.msg;return r.a.createElement("div",{className:"p-1"},r.a.createElement(Z,{replyToCommentObj:a,cancelOnClick:n.cancelReply,thread:t}),!0===o&&r.a.createElement(w,{comments:l,replyOnClick:n.toggleReplyMode}),!1===o&&r.a.createElement(p.a,null,r.a.createElement(d.a,null,c)))},n.state={comments:void 0,commentsLoaded:!1,replyCommentObj:void 0,thread:void 0,msg:"Loading..."},n.toggleReplyMode=n.toggleReplyMode.bind(Object(u.a)(n)),n.cancelReply=n.cancelReply.bind(Object(u.a)(n)),n}return Object(i.a)(t,e),t}(r.a.Component),$=I.disqusProxy,K=$.username,U=$.debug,Q=function(e){function t(e,a){var n;return Object(c.a)(this,t),(n=Object(s.a)(this,Object(m.a)(t).call(this,e,a))).componentDidMount=function(){if(U)n.setState({disqusLoaded:!0,disqusType:"proxy"});else{var e=document.createElement("script");e.src="https://".concat(K,".disqus.com/embed.js"),e.async=!0,e.setAttribute("data-timestamp",String(+new Date)),e.onload=function(){n.setState({disqusLoaded:!0,disqusType:"native"}),console.log("Native Disqus.")},e.onerror=function(){n.setState({disqusLoaded:!0,disqusType:"proxy"}),console.log("Proxy Disqus")},document.body.appendChild(e)}},n.render=function(){var e=n.state,t=e.disqusLoaded,a=e.disqusType;return r.a.createElement("div",{className:"App"},!1===t&&r.a.createElement("div",{className:"m-3"},r.a.createElement("i",{className:"mr-2 fa fa-circle-o-notch fa-spin"}),"Loading Disqus..."),!0===t&&"proxy"===a&&r.a.createElement(W,null))},n.state={disqusLoaded:!1,disqusType:"native"},n}return Object(i.a)(t,e),t}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(59);l.a.render(r.a.createElement(Q,null),document.getElementById("disqus_thread")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[38,1,2]]]);
//# sourceMappingURL=main.a6b4aba5.chunk.js.map